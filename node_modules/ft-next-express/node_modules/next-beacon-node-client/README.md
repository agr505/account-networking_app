# Next Beacon Node Client [![Build Status](https://travis-ci.org/Financial-Times/next-beacon-node-client.svg?branch=master)](https://travis-ci.org/Financial-Times/next-beacon-node-client)

App to allow [FT Beacons](https://github.com/Financial-Times/next-beacon-component) to be fired from the back end.

## Usage

In your app:

1. `npm install --save Financial-Times/next-beacon-node-client`
- Require it: `var beacon = require('next-beacon-node-client');`
- Fire it: `beacon.fire([eventType], [options])`

**Note: Make sure you only call beacon.fire *after* sending a response, e.g.**

```
var beaconData = {
	meta: {},
	user: {
		erights: req.get('X-FT-User-Id'),
		isStaff: req.get('X-FT-Staff'),
		flags: req.get('X-Flags')
	},
	page: {
		location: {
			pathname: req.route.path
		}
	}
};

res.status(200).send('Hello');

return beacon.fire('optin', beaconData);
```

## Environment Var

Make sure you add a BEACON_API_URL to your environment variables. See the (private) config-vars repo to grab this from an existing app.

## Local dev

To develop live, within an app:

1. `git clone https://github.com/Financial-Times/next-beacon-node-client.git`
- `cd next-beacon-node-client`
- `npm link`
- `cd` into the app you want to fire the beacon from
- `npm link next-beacon-node-client`
- `make run` in your app, after local changes to next-beacon-node-client