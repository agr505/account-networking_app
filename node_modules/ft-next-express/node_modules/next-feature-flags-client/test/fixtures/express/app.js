/*jshint node:true*/
'use strict';

var flags = require('../../../server');
var express = require('express');
var app = express();

var initializePromise = flags.init({ url: 'http://host.com/path.json' });
app.get('/path.json', flags.middleware, function(req, res) {
	initializePromise.then(function() {
		res.json(res.locals.flags);
	});
});

app.get('/array.json', flags.middleware, function(req, res) {
	initializePromise.then(function() {
		res.json(res.locals.flagsArray);
	});
});

app.get('/__gtg', function(req, res) {
	res.sendStatus(200).end();
});

if (process.env.PORT) {
	app.listen(process.env.PORT);
}

app.initializePromise = initializePromise;
module.exports = app;
