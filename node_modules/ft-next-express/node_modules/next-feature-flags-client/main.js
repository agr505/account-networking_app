'use strict';

var Flags = require('./lib/flags');
var toggler = require('./lib/toggler');
var oErrors = require('o-errors');
var aWeek = 1000 * 60 * 60 * 24 * 7;

if (!window.nextFeatureFlags) {
	throw 'Cannot initialise client side feature flags without window.nextFeatureFlags object';
}

module.exports = new Flags({
	overrides: toggler.override({}, toggler.readFromCookie(document.cookie)),
	flags: window.nextFeatureFlags,
	alerter: function (flag) {
		if (new Date().getTime() - (flag.expiry.getTime() + aWeek) <= 0) {
			return;
		}
		// would like to see this implemented https://github.com/Financial-Times/o-errors/issues/12
		// so this block isn't required
		try {
			oErrors.error(flag.name + 'expired more than a week ago but is still in the codebase');
		} catch (e) {}
	}
});
